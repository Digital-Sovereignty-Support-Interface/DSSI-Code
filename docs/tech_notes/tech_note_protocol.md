### I. 通信プロトコルによる取得可能情報の差異

ブラウザ拡張機能（`activeTab`権限や`webRequest`系API）を利用する場合、以下の情報が「向こうからやってくる情報」として取得可能です。

#### 1. `HTTP://` (非暗号化通信) の場合
現代のウェブにおいて `http` であること自体が最大の「技術的事実」であり、警告対象です。

* **取得できる事実:**
    * **通信内容の平文:** HTML、画像、スクリプトなど全てが暗号化されずに流れている事実。
    * **改ざんの可能性:** 経路上の第三者（Wi-Fi提供者、ISPなど）が内容を書き換えても検知できない状態。
* **DSSIが提示すべきチップス:**
    * **【事実】** 通信経路が暗号化されていません。
    * **【リスク】** 入力内容や閲覧履歴が、同じWi-Fi利用者やネットワーク管理者に筒抜けになる可能性があります。
    * **【構造的欠陥】** 通信の「完全性（Integrity）」が保証されないため、表示されている画面が「本物」である保証がありません（中間者攻撃のリスク）。

#### 2. `HTTPS://` (暗号化通信) の場合
単に「安全」とするのではなく、証明書の中身（メタデータ）を解析することで、より深い事実を抽出できます。

* **取得できる事実（証明書メタデータ）:**
    * **発行者 (Issuer):** 誰がそのサイトの実在証明をしたか（例: Let's Encrypt, DigiCert）。
    * **有効期限 (Validity):** 「あと3日で切れる」「発行から1年以上経過している」など。
    * **暗号化強度 (Cipher Suite):** 古い脆弱な暗号スイート（TLS 1.0/1.1など）を使っていないか。
    * **HSTS (HTTP Strict Transport Security):** 「次回から必ずHTTPSで接続せよ」という宣言ヘッダがあるか。
* **DSSIが提示すべきチップス:**
    * **【事実】** 通信は暗号化されています。（発行元: Let's Encrypt）
    * **【事実(警告)】** しかし、TLSのバージョンが古く（1.1）、現代のセキュリティ基準を満たしていません。
    * **【事実】** 証明書の有効期限が残り48時間を切っています（管理不全の兆候）。

---

### II. スクリプト（JavaScript）の受動的解析限界

JavaScriptの解析は「難読化（Minify/Obfuscate）」されていることが多く、ソースコードを読んで「何をしているか」を完全に理解するのは困難です。
しかし、**「何と繋がろうとしているか」「ブラウザのどの機能を使おうとしているか」**という**「挙動（Behavior）」**は受動的に観測可能です。

#### 1. 静的解析（ロードされた瞬間の観測）
スクリプトファイルの中身やURLを見るだけでわかる事実です。

* **サードパーティ・ドメイン:**
    * 現在見ているサイト（例: `example.com`）以外のドメイン（例: `tracker.io`）からスクリプトを読み込んでいるか。
    * **チップス:** 「このサイトは、広告配信や行動追跡のために、外部の5つの異なる企業にデータを送信するスクリプトを含んでいます。」
* **既知のライブラリ検知:**
    * フィンガープリント採取ライブラリ（`FingerprintJS`など）や、セッションリプレイツール（`LogRocket`, `Hotjar`など）のシグネチャが含まれているか。
    * **チップス:** 「【事実】操作画面を録画・再生する解析ツール（Session Replay）が読み込まれています。あなたのマウスの動きは記録されています。」

#### 2. 動的解析（実行時のAPI監視）
ブラウザ拡張機能は、ページ内のJSが「特定のブラウザ機能（API）」を呼び出した瞬間をフック（検知）できます。

* **イベントリスナーの監視（今回のMVPで実装済み）:**
    * `keydown`, `paste`, `copy` イベントを監視しているか。
    * **チップス:** 「貼り付け（Paste）操作がブロック、または監視されています。」
* **クリップボードへのアクセス:**
    * 勝手にクリップボードの中身を読もうとしたか、書き込もうとしたか。
* **センサーへのアクセス:**
    * 位置情報、カメラ、マイクへのアクセス権限を要求しようとしているか。
* **Canvas Fingerprinting:**
    * 画面に見えない描画を行って、ユーザーを特定しようとする挙動があるか。

---

### III. 次の実装フェーズ（Phase 1.5）の提案

上記を踏まえ、DSSIのコード (`DSSI-Code`) に実装すべき機能の候補です。

#### A. HTTP/HTTPS インスペクター (Priority: High)
* **実装:** `window.location.protocol` をチェックし、`http:` ならアドレスバー付近に警告チップスを出す。
* **拡張:** `https:` の場合、`securityDetails` API（拡張機能専用）を使って証明書の有効期限を取得し、切れそうな場合に警告する。

#### B. 外部接続カウンター (Priority: Mid)
* **実装:** `performance.getEntriesByType("resource")` を使い、読み込まれているスクリプトのドメインを集計する。
* **チップス:** 「このページは、現在見ているドメイン以外に、XX個の外部サーバーと通信しています。」

#### C. ペースト阻害の検知 (Priority: Low - 技術的に少し難しい)
* **実装:** パスワード欄に対し、`paste` イベントで `preventDefault()` が呼ばれているかを検知する。
* **チップス:** 「このサイトはパスワードの貼り付けを禁止しています。複雑なパスワードの使用を阻害する非推奨な実装です。」

---

まずは **「A. HTTP/HTTPS インスペクター」** から着手するのが、実装コストも低く、ユーザーへの教育効果（HTTPSがなぜ重要か）も高いためお勧めです。

いかがいたしましょうか？